\documentclass[dvipsnames]{article}
% \documentclass[dvipsnames]{ctexart}

\title{Linux Network}
\input{h}
\input{h-says}

\hypersetup{
  colorlinks=true,
  linkcolor=blue,
  filecolor=magenta,      
  urlcolor=cyan,
  pdftitle={Linux Network},
  pdfpagemode=FullScreen,
}
\urlstyle{same}

% --------------------------------------------------
\begin{document}
\maketitle

\begin{comment}
\section{Media Access Control (MAC) Address}

\subsection{what does it look like}

MAC address has format something like: \texttt{00-0c-29-3b-73-cb}

\cSay{
  In practice, these addresses are used to communicate between hosts in the
  same VLAN or subnet. If you look at a packet capture, at the start of a TCP
  conversation you'll see the sending host send a broadcast \Cola{ARP request} saying
  \begin{center}
    ``Who has IP address x.x.x.x ?''
  \end{center}
  The \Cola{ARP reply} from some host will be
  \begin{center}
    ``That's me, and my MAC address is aaaa.bbbb.cccc ?''
  \end{center}
}

\dSay{
  What if the target IP is on a different subnet ?
}

\cSay{
  Then the sender will \Cola{ARP for} the gateway for that subnet.

  Switch is much faster than router, because hosts can use MAC to communicate.
}

\dSay{So why router ?}

\cSay{
  Because switches only work in LAN.
}

\subsection{Organizationally Unique Identifier (OUI)}

\cSay{The leading (usually 3 ) bytes of a MAC address usually points to its
  manufacturer, like \texttt{OOtronics Ltd. Kibbutz Yizrael, IL} or \texttt{OOel Corporate Kedah,
    MY} see \url{https://standards-oui.ieee.org/oui/oui.txt}
}

\subsection{Address Resolution Protocol (ARP)}

\Cola{ARP} is used to find the MAC address of a network neighbour for a given IPv4 Address.

\cSay{
  When a host wants to \cola{talk} to another host \cola{in the same subnet} using its IP address, it will
  \begin{enumerate}
  \item check its \Cola{ARP cache} to see whether there's a MAC address that matches that IP.
  \item If there isn't, it will send an ARP request to the local broadcast address.
  \item When the corresponding MAC is found, it will \colb{establish port-to-port communications (Next)}.
  \end{enumerate}
}

\section{Port to Port : TCP and UDP}

\cSay{There're two types of ports:
  \begin{description}
  \item[fixed server ports:] $0 <= p <= 1023$ usually for \cola{server}
  \item[ephemeral (short-lived) ports:] $1024 <= p <= 65535$ usually for
    \cola{client}. Among them, we have
    \begin{itemize}
    \item $1024 <= p <= 49151$ user ports
    \item $49152  <= p <= 65535$ dynamic or private ports
    \end{itemize}
  \end{description}
}

\end{comment}

\section{DNS}

\subsection{public DNS}

DNS has a large and complex infrastructure on the internet. This is made up of
\begin{itemize}
\item 13 \cola{root name servers}(which are each a reliable cluster
  of servers)
\item a group of commonly used name servers (for instance, the servers at Google or Cloudflare)
\item a series of registrars who will, for a fee, register a DNS domain name for
  you -- for instance, your organization's domain name.
\end{itemize}

\dSay{So Route 53 service in AWS is one of the third kind}
\cSay{I guess so.}
\dSay{Who are the 13 clusters?}
\cSay{They are listed in \url{https://www.iana.org/domains/root/servers}. For example,
Verisign,Inc, Department of Defence, NASA,...


}


\subsection{internal DNS}
\cSay{

  However, for the most part, most administrators are working with the needs of
  their organization -- working with their \Cola{internal DNS} name servers that
  face their internal folks, or with their \colb{external DNS} name servers that
  face the internet. 

}

The internal DNS server has a \Cola{zone file} populated with DNS records for internal
DNS resolution. This file can either be populated
\begin{itemize}
\item manually by editing it
\item automatically by the clients
\item automatically by \Cola{Dynamic Host Configuration Protocol (DHCP) leases}.
\end{itemize}

\cSay{Often, all three methods are combined.}

The basic request flow is simple. A client makes a DNS request. \cola{If that
  request is for a host that's internal to the organization and the request is
  to an internal DNS server,} the DNS response is supplied immediately since
it's on that local DNS server.

If it's for an external host, then things are bit more complex -- for instance,
let's query for \texttt{www.example.com}.

\begin{tikzpicture}
  
  \tikzstyle{dnsStyle}=[inner sep=10pt,fill=\mycola!20,rounded corners]

  \newcounter{req}
  \newcommand{\dns}{DNS}

  \node at (10cm, 3cm)[dnsStyle, name=internal-dns] {\dns};

  \node at ([yshift=2cm]internal-dns) [name=we,dnsStyle,fill=\mycolb!20] {we};

  \newcommand{\noop}[1]{}

  \newcommand{\refPlusPlus}{
    \arabic{req}
    \makebox[0cm]{\stepcounter{req}} %ignore the width of it
  }

  % \uptodown[-latex]{we}{internal-dns}
  \draw[-latex] (we) --
  node [midway, left] {
    \refPlusPlus{}
  }
  (internal-dns);
  
  \draw[step=1cm,help lines,] (0,0) grid +(15cm,10cm);
  \matrix (M1) [matrix of nodes,
  nodes={style=dnsStyle},
  row sep=1.5cm,matrix anchor=south]{
    \dns\\
    \dns\\
    \dns\\
    \dns\\
  };

  % \draw[->] (M1-1-1.west) .. controls +(left:5mm) and +(left:10mm) ..  (M1-2-1.west);
  % ðŸ¦œ : another way 

  \newcommand{\comeAndGo}[2]{
    \draw[-latex] (#1) to[out = 180, in=180] node[auto,swap] {
      \refPlusPlus{}
    } (#2);

    \draw[-latex] (#2) to[out = 0, in=0] node[auto,swap] {
      \refPlusPlus{}
    } (#1);
  }

  \comeAndGo{M1-1-1}{M1-2-1}{2}{3}
  \comeAndGo{M1-1-1}{M1-3-1}{4}{5}
  \comeAndGo{M1-1-1}{M1-4-1}{6}{7}

  \draw[fill=gray]
  (7cm , 0) node[text centered] {Organization's Firewall}
  ++(-0.5cm,1cm) rectangle ++(1cm,8cm);
  
\end{tikzpicture}

\end{document}

% Local Variables:
% TeX-engine: luatex
% TeX-command-extra-options: "-shell-escape"
% TeX-master: "m.tex"
% End: