
\section{å¬ä¸€ä¸ªå…±è¯†}
è®©æˆ‘ä»¬æ¥æƒ³ä¸€ä¸ªå…±è¯†ã€‚ä¼˜å…ˆè¦æ±‚è¿™å‡ ç‚¹ï¼š
\begin{itemize}
\item å•èŠ‚ç‚¹å¯è·‘
\item å¯ï¼ˆç›¸å¯¹æ–¹ä¾¿åœ°ï¼‰åŠ¨æ€æ–°å¢èŠ‚ç‚¹
\end{itemize}
\emoji{parrot} : é‚£ä¹ˆæœ€ç®€å•çš„åº”è¯¥å°±æ˜¯
\begin{myBox}{å¬ä¸€ä¸ªå…±è¯† Listen-to-one Consensus}
  \label{cons-a}
  \begin{itemize}
  \item ç¬¬ä¸€ä¸ªèµ·çš„èŠ‚ç‚¹ä¸ºPrimaryã€‚
  \item æ–°å¢çš„èŠ‚ç‚¹å¾€Primaryä¸Šè¿æ¥ã€‚
  \end{itemize}
\end{myBox}

\emoji{parrot} : è¿™ä¸ªå…¶å®æœ¬è´¨ä¸Šå°±æ˜¯åœ¨é›†ç¾¤å†…éƒ¨çš„ä¸€ä¸ª Server-Client æ¶æ„å˜›ã€‚
ä¹Ÿå°±æ˜¯æ‰€æœ‰äººéƒ½åªå¬Primaryçš„ã€‚
\begin{center}
  \begin{tikzpicture}
    % \tikzstyle{every node}=[inner sep=2pt]
    \node[myNode,fill=\mycola,minimum height=4em] (a1) {primary};
    \foreach \d in {0,60,...,300}{
      \draw[latex-, very thick] (a1) -- (\d:3cm) node[myNode,fill=gray]{æ–°å¢èŠ‚ç‚¹};
      % \node[myNode,fill=gray]  at (\d:2cm) {};
    }
  \end{tikzpicture}
\end{center}
è¿™ä¸ªçš„ç¼ºç‚¹å°±æ˜¯\cola{ä¸»æœºdownäº†ï¼Œé›†ç¾¤å°±downäº†}ã€‚å®ƒçš„ä¼˜ç‚¹å°±æ˜¯æ–°å¢çš„èŠ‚ç‚¹åªéœ€è¦å’Œä¸»
èŠ‚ç‚¹è¿æ¥å°±è¡Œï¼Œè€Œä¸”éprimaryå½¼æ­¤ä¸éœ€è¦çŸ¥é“å½¼æ­¤ã€‚

\begin{tikzpicture}
  \emoji{parrot} é‚£ä¹ˆä»£ç è¯¥æ€ä¹ˆå†™å‘¢ï¼Ÿ\\
  \emoji{turtle} åœ¨å†™ä»£ç ä¹‹å‰æˆ‘ä»¬å…ˆå®šä¹‰å…±è¯†æ‰€éœ€è¦çš„æ¥å£å§ã€‚
\end{tikzpicture}
\subsection{å…±è¯†éœ€è¦çš„æ¥å£}
æŠ½è±¡ä¸€ç‚¹è®²ï¼Œå…±è¯†æœ€å°‘éœ€è¦ä¸¤ç»„å¤–éƒ¨æ¥å£ã€‚
\begin{enumerate}
\item ç½‘ç»œï¼Œè¿™ä¸ªåŒ…æ‹¬
  \begin{itemize}
  \item æ¥å—å¤–éƒ¨çš„è¯·æ±‚ï¼ˆç›‘å¬ï¼‰
  \item P2Pæ²Ÿé€š ï¼ˆç›‘å¬ + å‘é€ï¼‰
  \end{itemize}
\item æ‰§è¡Œï¼ŒæŠŠä¸€ä¸ªå‘½ä»¤å†™åˆ°å†…éƒ¨å­˜å‚¨ã€‚
\end{enumerate}
ç½‘ç»œçš„æ¥å£å¤§æ¦‚å¯ä»¥å®šä¹‰ä¸ºï¼š
\begin{simplepy}
class IEndpointBasedNetworkable(ABC):
    def listen(self,
               target: str,     # The target, e.g. "/"
               handler: Callable[[str,str],Optional[str]]
               # The handler, accepts
               #  - endpoint, e.g. "localhost:8080"
               #  - request data
               # returns the result
               ):
        pass
    def listened_endpoint(self) -> str:
        pass
    def send(self,endpoint: str, target: str, data: str) -> Optional[str]:
        # endpoint: the target, e.g. "localhost:8080"
        # target: e.g. "/hi"
        pass
    def clear(self):                # clears up all the listeners
        pass
\end{simplepy}
è€Œæ‰§è¡Œçš„æ¥å£ï¼Œå¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š
\begin{simplepy}
class IExecutable(ABC):
    def execute(self,command: str) -> str:
        pass
\end{simplepy}

\subsection{\textbf{å¬ä¸€ä¸ªå…±è¯†}ï¼Œä»£ç å®ç°}
é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹ç äº†,å…ˆä»æ„å»ºå‡½æ•°å¼€å§‹ï¼Œé™¤äº†æ‰§è¡Œå’Œç½‘ç»œä»¥å¤–ï¼Œæ„å»ºå‡½æ•°è¿˜æ¥å—ä¸€
ä¸ªå¯é€‰çš„\texttt{nodeToConnect}ï¼Œå¦‚æœæ²¡ç»™ï¼Œåˆ™è¯´æ˜è¿™ä¸ªæ˜¯ç¬¬ä¸€ä¸ªèµ·çš„èŠ‚ç‚¹ï¼ˆprimaryï¼‰ã€‚
\begin{simplepy}
class ListenToOneConsensus:
    def __init__(self,
                 n: IEndpointBasedNetworkable,
                 e: IExecutable,
                 nodeToConnect=''):
        self.net = n
        self.exe = e
        if nodeToConnect:
            self.primary = nodeToConnect
            self.is_primary = False
            self.ask_primary_for_entry()
            self.start_listening_as_sub()
            print_mt(f'{self.net.listened_endpoint()} started as sub ğŸ¸')
        else:
            print_mt(f'{self.net.listened_endpoint()} started as primary ğŸ¸')
            self.is_primary = True
            self.start_listening_as_primary()

\end{simplepy}
\emoji{parrot} ï¼š é‚£ä¹ˆå…·ä½“primaryå’ŒéprimaryèŠ‚ç‚¹éƒ½è¦ç›‘å¬å“ªäº›äº‹ä»¶å‘¢ï¼Ÿ

åœ¨ä»‹ç»å…·ä½“è¦ç›‘å¬å“ªäº›äº‹ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬æœ€å¥½å…ˆçœ‹ä¸€ä¸‹åœ¨â€œæ—¶å…‰é™å¥½â€çš„æƒ…å†µä¸‹ï¼Œé›†ç¾¤æ˜¯æ€ä¹ˆ
å·¥ä½œçš„ï¼š
\begin{center}
  \begin{tikzpicture}
    \node[myNode,fill=\mycola,minimum height=4em] (a1) {primary};
    \foreach \d in {300,20}{
      \draw[latex-, very thick] (a1) -- (\d:3cm) node[myNode,fill=gray,name=s-\d]{æ–°å¢èŠ‚ç‚¹};
      % \node[myNode,fill=gray]  at (\d:2cm) {};
    }
    \node (a1n) [text width=7cm,above left] at ([shift={(-2cm,0cm)}]a1.west){
      \begin{tcolorbox}[tile,fontupper=\small,
        left=0mm,
        boxsep=0mm
        ]
        \begin{itemize}
        \item æ¯æ”¶åˆ°ä¸€ä¸ª\colc{è¯·æ±‚}ï¼š
          \begin{enumerate}
          \item å…ˆæ‰§è¡Œä¸€ä¸‹ï¼Œ
          \item ç„¶åæ·»åŠ åˆ°ä¸€ä¸ª\cola{ç¬”è®°æœ¬}é‡Œï¼Œ
          \item ç„¶åå‘ç»™æ‰€æœ‰\colb{å·²çŸ¥ä¸‹çº§}ã€‚
          \end{enumerate}
        \item æ¯å½“æœ‰\colb{æ–°èŠ‚ç‚¹}è¦æ±‚åŠ å…¥æ—¶ï¼š
          \begin{enumerate}
          \item å…ˆæŠŠ\colb{å®ƒ}åŠ å…¥\colb{å·²çŸ¥ä¸‹çº§}ï¼Œ
          \item ç„¶åæŠŠ\cola{ç¬”è®°æœ¬}å‘ç»™\colc{å®ƒ}ä¸€ä»½ã€‚
          \end{enumerate}
        \end{itemize}
      \end{tcolorbox}
    };
    \draw[help lines,-o] (a1n) -- (a1);

    \node (s2n) [text width=7cm,above] at ([shift={(0cm,2cm)}] s-20.north){
      \begin{tcolorbox}[tile,fontupper=\small,
        left=0.5mm,
        boxsep=0mm]
        åœ¨åˆšå¼€å§‹çš„æ—¶å€™è¯·æ±‚\cola{primary}åŠ å…¥ã€‚
        \begin{itemize}
        \item æ¯æ”¶åˆ°æ¥è‡ª\cola{primary}çš„\colc{è¯·æ±‚}ï¼š æ‰§è¡Œ
        \item æ¯æ”¶åˆ°æ¥è‡ª\colb{client}çš„\colc{è¯·æ±‚}ï¼š ä¼ ç»™\cola{primary}
        \end{itemize}
      \end{tcolorbox}
    };

    \draw[help lines,o-] (s-20) -- (s2n);
  \end{tikzpicture}
\end{center}
Emm,é‚£ä¹ˆçœ‹æ¥ï¼Œprimaryå’Œéä¸»èŠ‚ç‚¹æ‰€è¦ç›‘å¬çš„ï¼ˆå’Œå‘é€çš„)ä¹Ÿå°±å¾ˆæ˜æ˜¾äº†ã€‚é¦–å…ˆæˆ‘ä»¬æ¥çœ‹
primaryéœ€è¦ç”¨åˆ°çš„æ–¹æ³•ã€‚
\begin{simplepy}
    def start_listening_as_primary(self):
        self.known_subs = []
        self.command_history = []
        self.net.listen('/pleaseAddMe',
                        self.handle_add_new_node)
        self.net.listen('/pleaseExecuteThis',
                        self.handle_execute_for_primary)

    def handle_add_new_node(self,sub_endpoint: str,
                            data: str) -> str:
        """[For primary] to add new node"""
        self.known_subs.append(sub_endpoint)
        return f"""
        Dear {sub_endpoint}
            You are in. and here is what we have so far:
            {','.join(self.command_history)}
                   Sincerely
                   {self.net.listened_endpoint()}, The primary.
        """

    def handle_execute_for_primary(self, endpoint: str,
                                   data: str) -> str:
        cmd = data
        self.command_history.append(cmd)
        self.exe.execute(cmd)
        for sub in self.known_subs:
            r = self.net.send(sub,'/pleaseExecuteThis',cmd)
            if r == None:
                print(f'âŒï¸ Node-{sub} is down,kick it off the group.')
                self.known_subs.remove(sub)

        return f"""
        Dear {endpoint}
             Your request has been carried out by our group.
             Members: {self.known_subs}
                 Sincerely
                 {self.net.listened_endpoint()}, The primary.
        """
\end{simplepy}
ç„¶åæ˜¯å…¶ä»–èŠ‚ç‚¹ç”¨åˆ°çš„æ–¹æ³•:
\begin{simplepy}
    def ask_primary_for_entry(self):
        r = self.net.send(self.primary,
                    '/pleaseAddMe',f"""
                    Hi primary {self.primary},
                       please add me in the group
                          Regards {self.net.listened_endpoint()}
                    """
                          )
        if r == None:
            raise Exception('Failed to join the group')
        # In response, the primary should send you the history .
        cmd = r.split('\n')[3]  # forth line is the command
        if cmd:
            self.exe.execute(cmd)

    def start_listening_as_sub(self):
        self.net.listen('/pleaseExecuteThis',
                        self.handle_execute_for_sub)
    def handle_execute_for_sub(self,endpoint: str,data: str) -> str:
        cmd = data
        if (endpoint == self.primary):
            self.exe.execute(cmd)
            return f"""
            Dear boss {self.primary},
                 Mission [{data}] is accomplished.
                     Sincerely
                     {self.net.listened_endpoint()}
            """
        else:
            # forward
            r = self.net.send(self.primary,
                                 '/pleaseExecuteThis',data)
            if r == None:
                raise Exception('failed to forward message to primary')
            return r
\end{simplepy}
æ‰€ä»¥æœ€åæ€»ç»“èµ·æ¥åº”è¯¥å°±æ˜¯ï¼š
\begin{simplepy}
class ListenToOneConsensus:
    def __init__(self,
                 n: IEndpointBasedNetworkable,
                 e: IExecutable,
                 nodeToConnect=''):
        self.net = n
        self.exe = e
        if nodeToConnect:
            self.primary = nodeToConnect
            self.is_primary = False
            self.ask_primary_for_entry()
            self.start_listening_as_sub()
            print_mt(f'{self.net.listened_endpoint()} started as sub ğŸ¸')
        else:
            print_mt(f'{self.net.listened_endpoint()} started as primary ğŸ¸')
            self.is_primary = True
            self.start_listening_as_primary()
    def start_listening_as_primary(self):
        self.known_subs = []
        self.command_history = []
        self.net.listen('/pleaseAddMe',
                        self.handle_add_new_node)
        self.net.listen('/pleaseExecuteThis',
                        self.handle_execute_for_primary)

    def handle_add_new_node(self,sub_endpoint: str,
                            data: str) -> str:
        """[For primary] to add new node"""
        self.known_subs.append(sub_endpoint)
        return f"""
        Dear {sub_endpoint}
            You are in. and here is what we have so far:
            {','.join(self.command_history)}
                   Sincerely
                   {self.net.listened_endpoint()}, The primary.
        """

    def handle_execute_for_primary(self, endpoint: str,
                                   data: str) -> str:
        cmd = data
        self.command_history.append(cmd)
        self.exe.execute(cmd)
        for sub in self.known_subs:
            r = self.net.send(sub,'/pleaseExecuteThis',cmd)
            if r == None:
                print(f'âŒï¸ Node-{sub} is down,kick it off the group.')
                self.known_subs.remove(sub)

        return f"""
        Dear {endpoint}
             Your request has been carried out by our group.
             Members: {self.known_subs}
                 Sincerely
                 {self.net.listened_endpoint()}, The primary.
        """

    # --------------------------------------------------
    def ask_primary_for_entry(self):
        r = self.net.send(self.primary,
                    '/pleaseAddMe',f"""
                    Hi primary {self.primary},
                       please add me in the group
                          Regards {self.net.listened_endpoint()}
                    """
                          )
        if r == None:
            raise Exception('Failed to join the group')
        # In response, the primary should send you the history .
        cmd = r.split('\n')[3]  # forth line is the command
        if cmd:
            self.exe.execute(cmd)

    def start_listening_as_sub(self):
        self.net.listen('/pleaseExecuteThis',
                        self.handle_execute_for_sub)
    def handle_execute_for_sub(self,endpoint: str,data: str) -> str:
        cmd = data
        if (endpoint == self.primary):
            self.exe.execute(cmd)
            return f"""
            Dear boss {self.primary},
                 Mission [{data}] is accomplished.
                     Sincerely
                     {self.net.listened_endpoint()}
            """
        else:
            # forward
            r = self.net.send(self.primary,
                                 '/pleaseExecuteThis',data)
            if r == None:
                raise Exception('failed to forward message to primary')
            return r

\end{simplepy}
é‚£ä¹ˆè®©æˆ‘å†™ä¸€ä¸‹mockedæ–¹æ³•ç„¶åæµ‹è¯•ä¸€ä¸‹å§,mockedç½‘ç»œå’Œå­˜å‚¨å¦‚ä¸‹:
\begin{simplepy}
  
\end{simplepy}
è€Œèµ·é›†ç¾¤çš„è¯åˆ™æ˜¯è¦è¿™æ ·:
\begin{simplepy}
  
\end{simplepy}

è¿™é‡Œæˆ‘ä»¬å¯ä»¥åŒè¿‡å‘½ä»¤è¡ŒåŠ¨æ€çš„å‘é›†ç¾¤å‘é€:
\begin{itemize}
\item \texttt{append} : æ–°å¢ä¸€ä¸ªèŠ‚ç‚¹
\item \texttt{kick} \cola{\texttt{<èŠ‚ç‚¹å>}} : åˆ é™¤ä¸€ä¸ªèŠ‚ç‚¹
\item \cola{\texttt{<èŠ‚ç‚¹å>}} \texttt{<å‘½ä»¤>} : å‘æŸèŠ‚ç‚¹å‘èµ·å‘½ä»¤
\end{itemize}

ç¤ºä¾‹ï¼š
\begin{tcolorbox}[breakable]
  
\begin{verbatim}
mark started as primary ğŸ¸ èŠ‚ç‚¹ã€markã€‘åŠ å…¥äº†é›†ç¾¤----------------------------
Adding handler: mark-/pleaseAddMe
Adding handler: mark-/pleaseExecuteThis
 Calling handler: mark-/pleaseAddMe  with data:
  
                    Hi primary mark,
                       please add me in the group
                          Regards moai
                     
Got result: 
        Dear moai
            You are in. and here is what we have so far:
            
                   Sincerely
                   mark, The primary.
         
ğŸ¦œ  [moai] Exec:              
Adding handler: moai-/pleaseExecuteThis
moai started as sub ğŸ¸ èŠ‚ç‚¹ã€moaiã€‘åŠ å…¥äº†é›†ç¾¤------------------------
 Calling handler: mark-/pleaseAddMe  with data:
  
                    Hi primary mark,
                       please add me in the group
                          Regards lay
                     
Got result: 
        Dear lay
            You are in. and here is what we have so far:
            
                   Sincerely
                   mark, The primary.
         
ğŸ¦œ  [lay] Exec:              
Adding handler: lay-/pleaseExecuteThis
lay started as sub ğŸ¸ èŠ‚ç‚¹ã€layã€‘åŠ å…¥äº†é›†ç¾¤-----------------------
Enter: moai aaa å¾€ã€moaiã€‘å‘é€å‘½ä»¤â€œaaaâ€---------------------------
 Sending aaa to moai 
 Calling handler: moai-/pleaseExecuteThis  with data:
  aaa 
 Calling handler: mark-/pleaseExecuteThis  with data:
  aaa 
ğŸ¦œ  [mark] Exec: aaa 
 Calling handler: moai-/pleaseExecuteThis  with data:
  aaa 
ğŸ¦œ  [moai] Exec: aaa 
Got result: 
            Dear boss mark,
                 Mission [aaa] is accomplished.
                     Sincerely
                     moai
             
 Calling handler: lay-/pleaseExecuteThis  with data:
  aaa 
ğŸ¦œ  [lay] Exec: aaa 
Got result: 
            Dear boss mark,
                 Mission [aaa] is accomplished.
                     Sincerely
                     lay
             
Got result: 
        Dear moai
             Your request has been carried out by our group.
             Members: ['moai', 'lay']
                 Sincerely
                 mark, The primary.
         
Got result: 
        Dear moai
             Your request has been carried out by our group.
             Members: ['moai', 'lay']
                 Sincerely
                 mark, The primary.
         
Enter: lay bbb å¾€ã€layã€‘å‘é€å‘½ä»¤â€œbbbâ€----------------------------
 Sending bbb to lay 
 Calling handler: lay-/pleaseExecuteThis  with data:
  bbb 
 Calling handler: mark-/pleaseExecuteThis  with data:
  bbb 
ğŸ¦œ  [mark] Exec: bbb 
 Calling handler: moai-/pleaseExecuteThis  with data:
  bbb 
ğŸ¦œ  [moai] Exec: bbb 
Got result: 
            Dear boss mark,
                 Mission [bbb] is accomplished.
                     Sincerely
                     moai
             
 Calling handler: lay-/pleaseExecuteThis  with data:
  bbb 
ğŸ¦œ  [lay] Exec: bbb 
Got result: 
            Dear boss mark,
                 Mission [bbb] is accomplished.
                     Sincerely
                     lay
             
Got result: 
        Dear lay
             Your request has been carried out by our group.
             Members: ['moai', 'lay']
                 Sincerely
                 mark, The primary.
         
Got result: 
        Dear lay
             Your request has been carried out by our group.
             Members: ['moai', 'lay']
                 Sincerely
                 mark, The primary.
         
Enter: kick lay  æŠŠã€layã€‘èŠ‚ç‚¹è¸¢äº†-------------------------
 Kicking node lay 
Removing handler: lay-/pleaseExecuteThis
Enter: moai ccc å¾€ã€moaiã€‘å‘é€å‘½ä»¤â€cccâ€œ--------------------------- 
 Sending ccc to moai 
 Calling handler: moai-/pleaseExecuteThis  with data:
  ccc 
 Calling handler: mark-/pleaseExecuteThis  with data:
  ccc 
ğŸ¦œ  [mark] Exec: ccc 
 Calling handler: moai-/pleaseExecuteThis  with data:
  ccc 
ğŸ¦œ  [moai] Exec: ccc 
Got result: 
            Dear boss mark,
                 Mission [ccc] is accomplished.
                     Sincerely
                     moai
             
 Calling handler: lay-/pleaseExecuteThis  with data:
  ccc 
Handler lay-/pleaseExecuteThis not found
Got result: None 
âŒï¸ Node-lay is down,kick it off the group.
Got result: 
        Dear moai
             Your request has been carried out by our group.
             Members: ['moai']
                 Sincerely
                 mark, The primary.
         
Got result: 
        Dear moai
             Your request has been carried out by our group.
             Members: ['moai']
                 Sincerely
                 mark, The primary.
         
Enter: append æ–°å¢èŠ‚ç‚¹ã€vestã€‘----------------------------------
 Appending node 
 Calling handler: mark-/pleaseAddMe  with data:
  
                    Hi primary mark,
                       please add me in the group
                          Regards vest
                     
Got result: 
        Dear vest
            You are in. and here is what we have so far:
            aaa,bbb,ccc
                   Sincerely
                   mark, The primary.
         
ğŸ¦œ  [vest] Exec:             aaa,bbb,ccc 
Adding handler: vest-/pleaseExecuteThis
vest started as sub ğŸ¸
Enter: vest ddd å¾€ã€vestã€‘èŠ‚ç‚¹å‘é€å‘½ä»¤"ddd"------------------------
 Sending ddd to vest å¾€vestå‘é€å‘½ä»¤ddd---------------------------
 Calling handler: vest-/pleaseExecuteThis  with data:
  ddd 
 Calling handler: mark-/pleaseExecuteThis  with data:
  ddd 
ğŸ¦œ  [mark] Exec: ddd 
 Calling handler: moai-/pleaseExecuteThis  with data:
  ddd 
ğŸ¦œ  [moai] Exec: ddd 
Got result: 
            Dear boss mark,
                 Mission [ddd] is accomplished.
                     Sincerely
                     moai
             
 Calling handler: vest-/pleaseExecuteThis  with data:
  ddd 
ğŸ¦œ  [vest] Exec: ddd 
Got result: 
            Dear boss mark,
                 Mission [ddd] is accomplished.
                     Sincerely
                     vest
             
Got result: 
        Dear vest
             Your request has been carried out by our group.
             Members: ['moai', 'vest']
                 Sincerely
                 mark, The primary.
         
Got result: 
        Dear vest
             Your request has been carried out by our group.
             Members: ['moai', 'vest']
                 Sincerely
                 mark, The primary.

\end{verbatim}

\end{tcolorbox}
\section{å¬ä¸€ä¸ªå…±è¯†-ç•™ä¸€æ‰‹ç‰ˆ}

è®©æˆ‘ä»¬ç¨å¾®å†å¤æ‚å¤æ‚ä¸€ç‚¹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½æ–°å¢è¿™ä¸¤ä¸ªåŠŸèƒ½ï¼š
\begin{enumerate}
\item åœ¨\cola{primary}æ­»çš„æ—¶å€™å¸Œæœ›å¯ä»¥æœ‰æ¥ç­çš„ã€‚
\item æˆ‘ä»¬å¸Œæœ›æ–°å¢èŠ‚ç‚¹çš„æ—¶å€™å¯ä»¥è¿æ¥åˆ°ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚
\end{enumerate}
\emoji{parrot} : æ—¢ç„¶\cola{primary}å¯ä»¥ç»™å‘½ä»¤ç¼–å·ï¼Œé‚£ä¹ˆè‡ªç„¶ä¹Ÿå¯ä»¥ç»™æ–°åŠ çš„èŠ‚ç‚¹ç¼–å·
ä¸æ˜¯å—ï¼Ÿ è€Œæˆ‘ä»¬ä¹Ÿå°±å¯ä»¥ç”¨è¿™ä¸ªç¼–å·æ¥å†³å®š\cola{è°æ˜¯ä¸‹ä¸€ä»»primary}ã€‚

æ˜¯çš„é‚£ä¹ˆè¿™æ ·ä»¥æ¥æˆ‘ä»¬çš„é›†ç¾¤å°±å˜æˆäº†ä¸€ä¸ªæœ‰åºå·çš„äº†:
\begin{center}
  \begin{tikzpicture}
    \begin{scope}
      \node[myNode,fill=\mycola,minimum height=4em] (a0) {primary};
      \draw[latex-, very thick] (a0) -- (30:3cm) node[myNode,fill=gray,name=a2]{...};
      \draw[latex-, very thick] (a0) -- (0:3cm) node[myNode,fill=gray,name=a4]{...};

      \draw[latex-, very thick] (a0) -- (300:3cm) node[myNode,fill=\mycolc,name=a1]{1};
      \draw[latex-, very thick] (a1) -- (270:3cm) node[myNode,fill=gray,name=a3]{...};

      \node[text width=6cm,below] at ([shift={(0,-3cm)}]a0.south) {
        \begin{noteBox}
          1.æ–°å¢çš„èŠ‚ç‚¹å¯ä»¥é€šè¿‡\textbf{ä»»æ„ç°
            æœ‰é›†ç¾¤èŠ‚ç‚¹}è¿æ¥ï¼Œä¹‹åä¼šç®¡\cola{primary}è¦ä¸€ä¸ªåºå·ã€‚
        \end{noteBox}
      };
      \node[left,text width=2cm] at ([xshift=-0.5cm]a3.west) {
        \begin{leftDialogBox}
          æ±‚åŠ å…¥
        \end{leftDialogBox}
      };

      \foreach \n in {a2}{
        \node[right,text width=2cm] at ([xshift=0.5cm,yshift=0.5cm]\n.east) {
          \begin{rightDialogBox}
            æ±‚åŠ å…¥
          \end{rightDialogBox}
        };
      }

    \end{scope}


    \begin{scope}[shift={(9.5cm,0)}]
      \node[myNode,fill=\mycola,minimum height=4em] (a0) {primary};
      \draw[latex-, very thick] (a0) -- (30:3cm) node[myNode,fill=\mycolaa,name=a2]{2};
      \draw[latex-, very thick] (a0) -- (0:3cm) node[myNode,fill=\mycolaa,name=a4]{4};

      \draw[latex-, very thick] (a0) -- (300:3cm) node[myNode,fill=\mycolc,name=a1]{1};
      \draw[latex-, very thick] (a1) -- (270:3cm) node[myNode,fill=\mycolaa,name=a3]{3};

      \draw[-latex,very thick] (a4) -- (a1);
      \draw[-latex,very thick] (a2) -- (a1);
      \draw[-latex,very thick] (a3) -- (a0);

      \node[text width=6cm,below] at ([shift={(0,-3cm)}]a0.south) {
        \begin{noteBox}
          2.åœ¨å®Œæˆä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤åï¼Œæ–°å¢çš„èŠ‚ç‚¹å°±ç®—åŠ å…¥é›†ç¾¤äº†ï¼š
          \begin{enumerate}
          \item è®°ä½\cola{primary}å’Œä¸‹ä»»\cola{primary}çš„åœ°å€
          \item è·å¾—è‡ªå·±çš„åºåˆ—å·ã€‚
          \item åŒæ­¥å‘½ä»¤å†å²è®°å½•
          \end{enumerate}
        \end{noteBox}
      };

      \node[left,text width=4cm] at ([xshift=-0.5cm]a0.west) {
        \begin{leftDialogBox}
          \small
          æ¥å§ï¼Œç»™ä½ ä»¬\textbf{è¿‡å¾€æˆ‘ä»¬æ‰§è¡Œçš„è®°å½•}ï¼Œå¦‚æœæˆ‘æ²¡äº†å°±æ‰¾ä¸‹ä¸€ä»»\colc{èŠ‚ç‚¹1}å§ã€‚
        \end{leftDialogBox}
      };
    \end{scope}
      \end{tikzpicture}
\end{center}

\begin{center}
  \begin{tikzpicture}
    \begin{scope}
      \node[myNode,fill=red!40!black,minimum height=4em] (a0) {primary};
      \draw[latex-, very thick] (a0) -- (30:3cm) node[myNode,fill=\mycolaa,name=a2]{2};
      \draw[latex-, very thick] (a0) -- (0:3cm) node[myNode,fill=\mycolaa,name=a4]{4};

      \draw[latex-, very thick] (a0) -- (300:3cm) node[myNode,fill=\mycolc,name=a1]{1};
      \draw[latex-, very thick] (a1) -- (270:3cm) node[myNode,fill=\mycolaa,name=a3]{3};

      \draw[-latex,very thick] (a4) -- (a1);
      \draw[-latex,very thick] (a2) -- (a1);
      \draw[-latex,very thick, red] (a3) -- node[midway] {\emoji{cross-mark}}(a0);

      \node[left,text width=4cm] at ([xshift=-0.5cm]a3.west) {
        \begin{leftDialogBox}
          ï¼Ÿ \cola{primary}è€ä¸å›æˆ‘ï¼Œå®ƒåº”è¯¥æ²¡äº†ï¼Œ\colc{ä½ }ä¸Šå‘—ï¼Ÿ
        \end{leftDialogBox}
      };

      \node[right,text width=4cm] at ([xshift=0.5cm,yshift=0.5cm]a1.east) {
        \begin{rightDialogBox}
          æ˜¯å—ï¼Ÿ è®©æˆ‘ç¡®è®¤ä¸€ä¸‹....å–‚å–‚å–‚ï¼Ÿ \cola{primary}åœ¨å—ï¼Ÿ
        \end{rightDialogBox}
      };

      \node[text width=8cm,below] at ([shift={(0,-4cm)}]a0.south) {
        \begin{noteBox}
          3. å½“æœ‰äººå¾€\cola{primary}å‘æ¶ˆæ¯å¤±è´¥åå°±ä¼šå’Œ\colc{æ¥ç­äºº}è¯´ï¼Œè¯·æ±‚\textbf{view-change}ã€‚
          ç„¶åï¼Œ\colc{æ¥ç­äºº}ä¼šï¼š
          \begin{enumerate}
          \item ç¡®è®¤ä¸€ä¸‹\cola{primary}æ˜¯ä¸æ˜¯çœŸçš„æ²¡äº†
          \item å¦‚æœä¸æ˜¯ï¼Œé‚£è¯´æ˜æ˜¯è¿™ä¸ªå°èŠ‚ç‚¹è‡ªå·±çš„é—®é¢˜
          \end{enumerate}
        \end{noteBox}
      };
    \end{scope}

    \begin{scope}[shift={(6cm,-6cm)}]
      \node[myNode,fill=red!40!black,minimum height=4em] (a0) {dead};
      \draw[latex-, very thick] (a0) -- (30:3cm) node[myNode,fill=\mycolc,name=a2]{2};
      \draw[latex-, very thick] (a0) -- (0:3cm) node[myNode,fill=\mycolaa,name=a4]{4};

      \draw[latex-, very thick,red] (a0) -- node[midway] {\emoji{cross-mark}}
      (300:3cm) node[myNode,fill=\mycola,
      name=a1,minimum height=4em]{primary};
      \draw[latex-, very thick] (a1) -- (270:3cm) node[myNode,fill=\mycolaa,name=a3]{3};

      \draw[-latex,very thick] (a4) -- (a1);
      \draw[-latex,very thick] (a2) -- (a1);
      \draw[-latex,very thick, red] (a3) -- node[midway,sloped] {\emoji{cross-mark}}(a0);

      % \node[left,text width=4cm] at ([xshift=-0.5cm]a3.west) {
      %   \begin{leftDialogBox}
      %     æ¬¸ï¼Ÿ \cola{primary}è€ä¸å›æˆ‘ï¼Œå®ƒåº”è¯¥æ²¡äº†ï¼Œ\colc{ä½ }ä¸Šå‘—ï¼Ÿ
      %   \end{leftDialogBox}
      % };

      \node[right,text width=4cm] at ([xshift=0.5cm,yshift=0.5cm]a1.east) {
        \begin{rightDialogBox}
          è¯¶å‘¦ï¼Œè¿˜çœŸæ²¡äº†...é‚£å¥½å§ã€‚\textbf{å¤§å®¶å¬å¥½äº†}ï¼Œ\cola{primary}è¯¥æ¢æˆ‘
          äº†ï¼Œ\colc{ä¸‹ä¸€ä¸ªæ˜¯èŠ‚ç‚¹\textbf{2}}ï¼Œä½ ä»¬éƒ½è®°ä½å•Šã€‚
        \end{rightDialogBox}
      };

      \node[text width=6cm,below] at ([shift={(0,-3cm)}]a0.south) {
        \begin{noteBox}
          4.å¦‚æœç¡®å®\colc{æ¥ç­äººè‡ªå·±}ä¹Ÿæ²¡æœ‰è¿ä¸Š\cola{ä¸»èŠ‚ç‚¹}ï¼Œåˆ™å¹¿æ’­\textbf{view-change},å¹¶è®©å¤§å®¶äº†
          è§£ä¸‹ä¸€ä»»\colc{æ¥ç­äºº}ã€‚
        \end{noteBox}
      };
    \end{scope}
  \end{tikzpicture}
\end{center}

\begin{myBox}{å¬ä¸€ä¸ªå…±è¯†-ç•™ä¸€æ‰‹ç‰ˆ ï¼ˆFollow-me Consensusï¼‰}
  \begin{itemize}
  \item æ¯ä¸ªæ–°åŠ çš„çš„èŠ‚ç‚¹ä¼šç®¡ä¸»èŠ‚ç‚¹è¦ä¸€ä¸ªåºå·
  \item ä¹‹åæ‰€æœ‰çš„èŠ‚ç‚¹éƒ½ä¼šè®°ä½ä¸¤ä¸ªåœ°å€ï¼š \cola{ä¸»èŠ‚ç‚¹}å’Œ\colb{ä¸‹ä¸€ä»»ä¸»èŠ‚ç‚¹}ã€‚(å­˜
    åœ¨ä¸€ä¸ªåˆ—è¡¨é‡Œï¼‰
  \item å½“èŠ‚ç‚¹ä»¬å—åˆ°æ¥è‡ª\colb{ä¸‹ä¸€ä»»ä¸»èŠ‚ç‚¹}çš„\textbf{ä¸Šä»»é€šçŸ¥æ—¶}ï¼Œåˆ‡æ¢ä¸»èŠ‚ç‚¹ã€‚
  \end{itemize}
\end{myBox}

\begin{tcolorbox}
  \emoji{parrot} : é‚£å¦‚æœä¸€ä¸ªèŠ‚ç‚¹åŒæ—¶æ”¶åˆ°ä¸¤ä¸ª\cola{primary}çš„æ¶ˆæ¯æ€ä¹ˆåŠå‘¢ï¼Ÿ\\
  \emoji{turtle} : é‚£ä¹ˆå°±å’Œå…¶ä»–çš„å…±è¯†ç®—æ³•ä¸€æ ·ï¼ˆRaftï¼ŒPBFTï¼‰ï¼Œ èŠ‚ç‚¹åªéœ€è¦æ¥å—æœ€æ–°çš„å‘½ä»¤å°±è¡Œäº†ã€‚
\end{tcolorbox}

% Local Variables:
% TeX-engine: luatex
% TeX-command-extra-options: "-shell-escape"
% TeX-master: "m.tex"
% End: