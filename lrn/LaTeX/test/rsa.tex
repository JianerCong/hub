\documentclass[dvipsnames]{article}

\title{RSA}
\usepackage{geometry}\geometry{
  a4paper,
  total={170mm,257mm},
  left=20mm,
  top=20mm,
}

\usepackage{svg}

\usepackage[skip=10pt plus1pt, indent=0pt]{parskip}
% Color
\newcommand{\mycola}{MidnightBlue}
\newcommand{\mycolb}{Mahogany}
\newcommand{\mycolc}{OliveGreen}

\newcommand{\cola}[1]{\textcolor{\mycola}{#1}}
\newcommand{\colb}[1]{\textcolor{\mycolb}{#1}}
\newcommand{\colc}[1]{\textcolor{\mycolc}{#1}}
\newcommand{\Cola}[1]{\textcolor{\mycola}{\textbf{#1}}}

% \let\emph\relax % there's no \RedeclareTextFontCommand
% \DeclareTextFontCommand{\emph}{\bfseries}
\renewcommand{\emph}[1]{\texbf{#1}}

\usepackage{fontspec}
\setmonofont{Cascadia}[
Path=/usr/share/fonts/truetype/Cascadia_Code/,
Scale=0.85,
Extension = .ttf,
UprightFont=*Code,              %find CascadiaCode.ttf
BoldFont=*CodePL,               %find CascadiaCodePL.ttf ...
ItalicFont=*CodeItalic,
BoldItalicFont=*CodePLItalic
]
\usepackage{minted}
\usepackage{tcolorbox}
\tcbuselibrary{skins}
\tcbuselibrary{minted}
\usepackage{tikz}
\usetikzlibrary{shapes} % ellipse node shape
\usetikzlibrary{shapes.multipart} % for line breaks in node text
\usetikzlibrary{arrows.meta}    %-o arrow head
\usetikzlibrary{arrows}
\usetikzlibrary{matrix}


% Redefine em
% latex.sty just do: \DeclareTextFontCommand{\emph}{\em}

\let\emph\relax % there's no \RedeclareTextFontCommand
\DeclareTextFontCommand{\emph}{\bfseries\em}
\usepackage{amsmath}

% ??? still xelatex?
% \usepackage{xeCJK}
\usepackage{emoji}

\date{\today}
\author{me}

\newtcblisting{simplec}{
  listing engine=minted,
  minted language=c++,
  minted style=vs,
  minted options={fontsize=\small,autogobble,
    % framesep=1cm
  },
  tile,
  listing only,
  % bottom=0cm,
  % nobeforeafter, 
  boxsep=0mm,
  left=1mm,
  opacityback=0.5,
  colback=gray!20
}

\newtcolorbox{blackbox}{tile,colback=black,colupper=white,nobeforeafter,halign=flush center}

\tikzstyle{myMatrix}=[matrix of nodes,below right,
nodes={above,text centered},                  %apply to all nodes
row sep=1cm,column sep=2cm]
\tikzstyle{every node}=[inner sep=0pt]

\newcommand\uptoleft[3][-o]{\draw[very thick,#1](#2.south) |- (#3.west);}
\newcommand\uptodown[3][-o]{\draw[very thick,#1](#2.south) to [out=270,in=90] (#3.north);}
\newcommand\downtoup[3][-latex]{\draw[very thick,#1](#2.north) to [out=90,in=270] (#3.south);}

\begin{document}
\maketitle

\section{What is asymmetric encryption?}

The first step in knowing how to encrypt a message is understanding \Cola{
  asymmetric encryption} (also called \Cola{public key encryption} ).

\emoji{turtle}  : You probably know that all the emails you send are ``in the clear'' for anyone
sitting in between you and your recipients's email provider to read. That's not
great. How do you fix this? You could use a cryptographic primitive like
AES-GCM. To do that, you would need to set up a shared symmetric secret for each
person that wants to message you.\\
\emoji{parrot}  :But you don't known in advance who'll want to message you.\\
\emoji{turtle}  :This is where \Cola{ asymmetric encryption} helps by allowing anyone in
possesion of your public key to encrypt messages to you.\\
Furthurmore, you are the only one who can decrypt these messages using the
associated private key that only you own.

\begin{center}
  \begin{tikzpicture}
    \matrix (M1) [myMatrix]{
      \emoji{crocodile} \\
      \emoji{lizard} &[3cm] {\Huge \emoji{t-rex}}\\
      \emoji{snake} \\
    };
    \foreach \i in {1,2,3}{
      \draw[-latex,very thick] (M1-\i-1) -- (M1-2-2)
      node[pos=0.4,sloped,above] {\small Encrypted message};
    }

    % The left speaking box
    \node[left,text width=5cm] at ([xshift=-0.5cm]M1-3-1.west) {
      \begin{tcolorbox}[tile,
        nobeforeafter,
        boxsep=0pt,
        % show bounding box,
        colback=\mycola!10,
        overlay={
          \begin{scope}
            % \fill[gray!10] (frame.east) circle (2pt);
            \fill[\mycola!10] (frame.east) --
            +(0,2mm) --
            +(3mm,0) --
            +(0,-2mm)
            ;
          \end{scope}
        }
        ]
        I can't decrypt other's messages.
      \end{tcolorbox}
    };

    \node[right,text width=5cm] at ([xshift=0.5cm]M1-2-2.east) {
      \begin{tcolorbox}[tile,
        nobeforeafter,
        boxsep=0pt,
        % show bounding box,
        colback=\mycola!10,
        overlay={
          \begin{scope}
            % \fill[gray!10] (frame.east) circle (2pt);
            \fill[\mycola!10] (frame.west) --
            +(0,2mm) --
            +(-3mm,0) --
            +(0,-2mm)
            ;
          \end{scope}
        }]
        I will decrypt them all.
      \end{tcolorbox}
    };
  \end{tikzpicture}
\end{center}

To set up asymemetric encryption, you first need to generate a \textbf{key pair} via some
algorithm. As with any setup function or cryptographic algorithms, the key
generation algorithm accepts a \Cola{security parameter}. This security
parameter usually translates to \cola{``how big do you want your keys to be?''},
where bigger means more secure.

\begin{center}
  \begin{tikzpicture}
    \node (a1) {Security parameter};
    \node[text width=5cm] (a2) at ([yshift=-1.5cm]a1.south) {
      \begin{tcolorbox}[tile,colback=black,colupper=white,nobeforeafter,halign=flush
        center]
        Generate asymemetric key pair
      \end{tcolorbox}
    };
    
    \matrix (M2) [myMatrix,below] at ([yshift=-1cm]a2.south){
      |[text width=1.5cm,text badly centered]| Private key &
      |[text width=1.5cm,text badly centered]| Public key\\
    };

    \draw[latex-,thick] (M2-1-1) -- (M2-1-1.north |- a2.south);
    \draw[latex-,thick] (M2-1-2) -- (M2-1-2.north |- a2.south);
    \draw[-latex,thick] ([yshift=-2mm]a1.south) -- (a2.north);
  \end{tikzpicture}
\end{center}

The generated key pair comprised of two different parts:
\begin{description}
\item[public key] can be published and shared.
\item[private key] must remain secret.
\end{description}

Anyone can use the public key part to encrypt messages, and you can use the
private key part to decrypt.

\begin{center}
  \begin{tikzpicture}
    \matrix (M1) [myMatrix,above, column sep=1cm]{
      Message & Public key &[2cm] Ciphertext & Private key\\
    };

    \matrix (M2) [myMatrix,below,column sep=3cm,text width=4cm,text centered] at ([yshift=-1cm]M1.south){
      % |[text width=3cm]|
      \begin{tcolorbox}[tile,colback=black,colupper=white,nobeforeafter,halign=flush
        center]
        Asymmetric encryption
      \end{tcolorbox}
      &
      % |[text width=3cm]|
      \begin{tcolorbox}[tile,colback=black,colupper=white,nobeforeafter,halign=flush
        center]
        Asymmetric decryption
      \end{tcolorbox}
      \\
      % |[text centered]|
      % ðŸ¦œ : They can be specified in the matrix definition
      Ciphertext &
      % |[text centered]|
      Plaintext or error
      \\
    };

    \foreach \i in {1,2}{
      \draw[-latex,thick] (M2-1-\i.south) -- (M2-2-\i.north);

      \draw[-latex,thick] (M1-1-\i.south) -- (M1-1-\i.south |- M2-1-1.north);
    }

    \foreach \i in {3,4}{
      \draw[-latex,thick] (M1-1-\i.south) -- (M1-1-\i.south |- M2-1-2.north);
    }

    % draw the cypher texts
    \draw[thick, -latex] (M2-2-1.east) -| (0,0) |- ([xshift=-0.3cm] M1-1-3.west);
    
  \end{tikzpicture}
\end{center}

Note that so far we haven't talked about authentication. Consider both sides of the wire:
\begin{itemize}
\item You are encrypting to a public key which you think is owned by Alice.
\item Alice does not know or sure who sent this message.
\end{itemize}

For now, we will imagine that we obtained Alice's public key in a really secure way. In 

\section{Asymmetric encryption in practice and hybrid encryption}

In reality, asymemetric encryption is quite limited due to the restricted\textbf{ length
of messages} it can encrypt. The \cola{speed of asymmetric encryption and
decryption} is also slow in comparison to symmetric encryption.

This is due to asymmetric constructions implementing math operations, as opposed
to symmetric primitives that often just manipulate bits.

\subsection{Key exchange and key encapsulation}
It turns out that asymmetric encryption can be used to perform a key exchange,
you can start by generating a symmetric key and encrypt it with Alice's public
key --- what we also call \Cola{encapsulating a key}.

\begin{center}
  \begin{tikzpicture}
    \matrix[myMatrix] (M1) {
      Security parameter & \\
      |[text width=4cm]|
      \begin{blackbox}
        Generate \\
        symmetric key
      \end{blackbox}  & \\
      Symmetric key \emoji{key} & Alice's public key\\
    };

    \matrix(M2) [myMatrix,below] at ([yshift=-1.5cm,xshift=0.5cm]M1.south){
      |[text width=4cm]|
      \begin{blackbox}
        Asymmetric \\ encryption
      \end{blackbox} \\
      Encrypted symmetric key \emoji{locked-with-key}\\
    };

    \uptodown[-latex]{M1-1-1}{M1-2-1};
    \uptodown[-latex]{M1-2-1}{M1-3-1};

    \uptodown[-latex]{M1-3-1}{M2-1-1}
    \uptodown[-latex]{M1-3-2}{M2-1-1}

    \uptodown[-latex]{M2-1-1}{M2-2-1}
  \end{tikzpicture}
\end{center}

\begin{center}
  \includesvg[width=0.2\linewidth]{/home/me/Pictures/myfirstsvg.svg}
\end{center}

\end{document}


% Local Variables:
% TeX-engine: luatex
% TeX-command-extra-options: "-shell-escape"
% End: